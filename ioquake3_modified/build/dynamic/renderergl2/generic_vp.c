const char *fallbackShader_generic_vp =
"attribute vec3 attr_Position;\n"
"attribute vec3 attr_Normal;\n"
"\n"
"#if defined(USE_VERTEX_ANIMATION)\n"
"attribute vec3 attr_Position2;\n"
"attribute vec3 attr_Normal2;\n"
"#elif defined(USE_BONE_ANIMATION)\n"
"attribute vec4 attr_BoneIndexes;\n"
"attribute vec4 attr_BoneWeights;\n"
"#endif\n"
"\n"
"attribute vec4 attr_Color;\n"
"attribute vec4 attr_TexCoord0;\n"
"\n"
"#if defined(USE_TCGEN)\n"
"attribute vec4 attr_TexCoord1;\n"
"#endif\n"
"\n"
"#if defined(USE_TCMOD)\n"
"uniform vec4   u_DiffuseTexMatrix0;\n"
"uniform vec4   u_DiffuseTexMatrix1;\n"
"uniform vec4   u_DiffuseTexMatrix2;\n"
"uniform vec4   u_DiffuseTexMatrix3;\n"
"uniform vec4   u_DiffuseTexMatrix4;\n"
"uniform vec4   u_DiffuseTexMatrix5;\n"
"uniform vec4   u_DiffuseTexMatrix6;\n"
"uniform vec4   u_DiffuseTexMatrix7;\n"
"#endif\n"
"\n"
"#if defined(USE_TCGEN) || defined(USE_RGBAGEN)\n"
"uniform vec3   u_LocalViewOrigin;\n"
"#endif\n"
"\n"
"#if defined(USE_TCGEN)\n"
"uniform int    u_TCGen0;\n"
"uniform vec3   u_TCGen0Vector0;\n"
"uniform vec3   u_TCGen0Vector1;\n"
"#endif\n"
"\n"
"#if defined(USE_FOG)\n"
"uniform vec4   u_FogDistance;\n"
"uniform vec4   u_FogDepth;\n"
"uniform float  u_FogEyeT;\n"
"uniform vec4   u_FogColorMask;\n"
"#endif\n"
"\n"
"#if defined(USE_DEFORM_VERTEXES)\n"
"uniform int    u_DeformGen;\n"
"uniform float  u_DeformParams[5];\n"
"uniform float  u_Time;\n"
"#endif\n"
"\n"
"uniform mat4   u_ModelViewProjectionMatrix;\n"
"uniform vec4   u_BaseColor;\n"
"uniform vec4   u_VertColor;\n"
"\n"
"#if defined(USE_RGBAGEN)\n"
"uniform int    u_ColorGen;\n"
"uniform int    u_AlphaGen;\n"
"uniform vec3   u_AmbientLight;\n"
"uniform vec3   u_DirectedLight;\n"
"uniform vec3   u_ModelLightDir;\n"
"uniform float  u_PortalRange;\n"
"#endif\n"
"\n"
"#if defined(USE_VERTEX_ANIMATION)\n"
"uniform float  u_VertexLerp;\n"
"#elif defined(USE_BONE_ANIMATION)\n"
"uniform mat4 u_BoneMatrix[MAX_GLSL_BONES];\n"
"#endif\n"
"\n"
"varying vec2   var_DiffuseTex;\n"
"varying vec4   var_Color;\n"
"\n"
"#if defined(USE_DEFORM_VERTEXES)\n"
"vec3 DeformPosition(const vec3 pos, const vec3 normal, const vec2 st)\n"
"{\n"
"\tfloat base =      u_DeformParams[0];\n"
"\tfloat amplitude = u_DeformParams[1];\n"
"\tfloat phase =     u_DeformParams[2];\n"
"\tfloat frequency = u_DeformParams[3];\n"
"\tfloat spread =    u_DeformParams[4];\n"
"\n"
"\tif (u_DeformGen == DGEN_BULGE)\n"
"\t{\n"
"\t\tphase *= st.x;\n"
"\t}\n"
"\telse // if (u_DeformGen <= DGEN_WAVE_INVERSE_SAWTOOTH)\n"
"\t{\n"
"\t\tphase += dot(pos.xyz, vec3(spread));\n"
"\t}\n"
"\n"
"\tfloat value = phase + (u_Time * frequency);\n"
"\tfloat func;\n"
"\n"
"\tif (u_DeformGen == DGEN_WAVE_SIN)\n"
"\t{\n"
"\t\tfunc = sin(value * 2.0 * M_PI);\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_SQUARE)\n"
"\t{\n"
"\t\tfunc = sign(fract(0.5 - value));\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_TRIANGLE)\n"
"\t{\n"
"\t\tfunc = abs(fract(value + 0.75) - 0.5) * 4.0 - 1.0;\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_SAWTOOTH)\n"
"\t{\n"
"\t\tfunc = fract(value);\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_INVERSE_SAWTOOTH)\n"
"\t{\n"
"\t\tfunc = (1.0 - fract(value));\n"
"\t}\n"
"\telse // if (u_DeformGen == DGEN_BULGE)\n"
"\t{\n"
"\t\tfunc = sin(value);\n"
"\t}\n"
"\n"
"\treturn pos + normal * (base + func * amplitude);\n"
"}\n"
"#endif\n"
"\n"
"#if defined(USE_TCGEN)\n"
"vec2 GenTexCoords(int TCGen, vec3 position, vec3 normal, vec3 TCGenVector0, vec3 TCGenVector1)\n"
"{\n"
"\tvec2 tex = attr_TexCoord0.st;\n"
"\n"
"\tif (TCGen == TCGEN_LIGHTMAP)\n"
"\t{\n"
"\t\ttex = attr_TexCoord1.st;\n"
"\t}\n"
"\telse if (TCGen == TCGEN_ENVIRONMENT_MAPPED)\n"
"\t{\n"
"\t\tvec3 viewer = normalize(u_LocalViewOrigin - position);\n"
"\t\tvec2 ref = reflect(viewer, normal).yz;\n"
"\t\ttex.s = ref.x * -0.5 + 0.5;\n"
"\t\ttex.t = ref.y *  0.5 + 0.5;\n"
"\t}\n"
"\telse if (TCGen == TCGEN_VECTOR)\n"
"\t{\n"
"\t\ttex = vec2(dot(position, TCGenVector0), dot(position, TCGenVector1));\n"
"\t}\n"
"\t\n"
"\treturn tex;\n"
"}\n"
"#endif\n"
"\n"
"#if defined(USE_TCMOD)\n"
"vec2 ModTexCoords(vec2 st, vec3 position, vec4 texMatrix[8])\n"
"{\n"
"\tvec2 st2 = st;\n"
"\tvec2 offsetPos = vec2(position.x + position.z, position.y);\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[0].x + st2.y * texMatrix[0].y + texMatrix[0].z,\n"
"\t           st2.x * texMatrix[1].x + st2.y * texMatrix[1].y + texMatrix[1].z);\n"
"\tst2 += texMatrix[0].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[1].w * 2.0 * M_PI));\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[2].x + st2.y * texMatrix[2].y + texMatrix[2].z,\n"
"\t           st2.x * texMatrix[3].x + st2.y * texMatrix[3].y + texMatrix[3].z);\n"
"\tst2 += texMatrix[2].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[3].w * 2.0 * M_PI));\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[4].x + st2.y * texMatrix[4].y + texMatrix[4].z,\n"
"\t           st2.x * texMatrix[5].x + st2.y * texMatrix[5].y + texMatrix[5].z);\n"
"\tst2 += texMatrix[4].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[5].w * 2.0 * M_PI));\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[6].x + st2.y * texMatrix[6].y + texMatrix[6].z,\n"
"\t           st2.x * texMatrix[7].x + st2.y * texMatrix[7].y + texMatrix[7].z);\n"
"\tst2 += texMatrix[6].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[7].w * 2.0 * M_PI));\n"
"\n"
"\treturn st2;\n"
"}\n"
"#endif\n"
"\n"
"#if defined(USE_RGBAGEN)\n"
"vec4 CalcColor(vec3 position, vec3 normal)\n"
"{\n"
"\tvec4 color = u_VertColor * attr_Color + u_BaseColor;\n"
"\t\n"
"\tif (u_ColorGen == CGEN_LIGHTING_DIFFUSE)\n"
"\t{\n"
"\t\tfloat incoming = clamp(dot(normal, u_ModelLightDir), 0.0, 1.0);\n"
"\n"
"\t\tcolor.rgb = clamp(u_DirectedLight * incoming + u_AmbientLight, 0.0, 1.0);\n"
"\t}\n"
"\t\n"
"\tvec3 viewer = u_LocalViewOrigin - position;\n"
"\n"
"\tif (u_AlphaGen == AGEN_LIGHTING_SPECULAR)\n"
"\t{\n"
"\t\tvec3 lightDir = normalize(vec3(-960.0, 1980.0, 96.0) - position);\n"
"\t\tvec3 reflected = -reflect(lightDir, normal);\n"
"\t\t\n"
"\t\tcolor.a = clamp(dot(reflected, normalize(viewer)), 0.0, 1.0);\n"
"\t\tcolor.a *= color.a;\n"
"\t\tcolor.a *= color.a;\n"
"\t}\n"
"\telse if (u_AlphaGen == AGEN_PORTAL)\n"
"\t{\n"
"\t\tcolor.a = clamp(length(viewer) / u_PortalRange, 0.0, 1.0);\n"
"\t}\n"
"\t\n"
"\treturn color;\n"
"}\n"
"#endif\n"
"\n"
"#if defined(USE_FOG)\n"
"float CalcFog(vec3 position)\n"
"{\n"
"\tfloat s = dot(vec4(position, 1.0), u_FogDistance) * 8.0;\n"
"\tfloat t = dot(vec4(position, 1.0), u_FogDepth);\n"
"\n"
"\tfloat eyeOutside = float(u_FogEyeT < 0.0);\n"
"\tfloat fogged = float(t >= eyeOutside);\n"
"\n"
"\tt += 1e-6;\n"
"\tt *= fogged / (t - u_FogEyeT * eyeOutside);\n"
"\n"
"\treturn s * t;\n"
"}\n"
"#endif\n"
"\n"
"void main()\n"
"{\n"
"#if defined(USE_VERTEX_ANIMATION)\n"
"\tvec3 position  = mix(attr_Position, attr_Position2, u_VertexLerp);\n"
"\tvec3 normal    = mix(attr_Normal,   attr_Normal2,   u_VertexLerp);\n"
"#elif defined(USE_BONE_ANIMATION)\n"
"\tmat4 vtxMat  = u_BoneMatrix[int(attr_BoneIndexes.x)] * attr_BoneWeights.x;\n"
"\t     vtxMat += u_BoneMatrix[int(attr_BoneIndexes.y)] * attr_BoneWeights.y;\n"
"\t     vtxMat += u_BoneMatrix[int(attr_BoneIndexes.z)] * attr_BoneWeights.z;\n"
"\t     vtxMat += u_BoneMatrix[int(attr_BoneIndexes.w)] * attr_BoneWeights.w;\n"
"\tmat3 nrmMat = mat3(cross(vtxMat[1].xyz, vtxMat[2].xyz), cross(vtxMat[2].xyz, vtxMat[0].xyz), cross(vtxMat[0].xyz, vtxMat[1].xyz));\n"
"\n"
"\tvec3 position  = vec3(vtxMat * vec4(attr_Position, 1.0));\n"
"\tvec3 normal    = normalize(nrmMat * attr_Normal);\n"
"#else\n"
"\tvec3 position  = attr_Position;\n"
"\tvec3 normal    = attr_Normal;\n"
"#endif\n"
"\n"
"#if defined(USE_DEFORM_VERTEXES)\n"
"\tposition = DeformPosition(position, normal, attr_TexCoord0.st);\n"
"#endif\n"
"\n"
"\tgl_Position = u_ModelViewProjectionMatrix * vec4(position, 1.0);\n"
"\n"
"#if defined(USE_TCGEN)\n"
"\tvec2 tex = GenTexCoords(u_TCGen0, position, normal, u_TCGen0Vector0, u_TCGen0Vector1);\n"
"#else\n"
"\tvec2 tex = attr_TexCoord0.st;\n"
"#endif\n"
"\n"
"#if defined(USE_TCMOD)\n"
"\tvec4 diffuseTexMatrix[8];\n"
"\tdiffuseTexMatrix[0] = u_DiffuseTexMatrix0;\n"
"\tdiffuseTexMatrix[1] = u_DiffuseTexMatrix1;\n"
"\tdiffuseTexMatrix[2] = u_DiffuseTexMatrix2;\n"
"\tdiffuseTexMatrix[3] = u_DiffuseTexMatrix3;\n"
"\tdiffuseTexMatrix[4] = u_DiffuseTexMatrix4;\n"
"\tdiffuseTexMatrix[5] = u_DiffuseTexMatrix5;\n"
"\tdiffuseTexMatrix[6] = u_DiffuseTexMatrix6;\n"
"\tdiffuseTexMatrix[7] = u_DiffuseTexMatrix7;\n"
"\tvar_DiffuseTex = ModTexCoords(tex, position, diffuseTexMatrix);\n"
"#else\n"
"    var_DiffuseTex = tex;\n"
"#endif\n"
"\n"
"#if defined(USE_RGBAGEN)\n"
"\tvar_Color = CalcColor(position, normal);\n"
"#else\n"
"\tvar_Color = u_VertColor * attr_Color + u_BaseColor;\n"
"#endif\n"
"\n"
"#if defined(USE_FOG)\n"
"\tvar_Color *= vec4(1.0) - u_FogColorMask * sqrt(clamp(CalcFog(position), 0.0, 1.0));\n"
"#endif\n"
"}\n"
;

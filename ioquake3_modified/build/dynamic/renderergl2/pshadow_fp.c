const char *fallbackShader_pshadow_fp =
"uniform sampler2D u_ShadowMap;\n"
"\n"
"uniform vec3      u_LightForward;\n"
"uniform vec3      u_LightUp;\n"
"uniform vec3      u_LightRight;\n"
"uniform vec4      u_LightOrigin;\n"
"uniform float     u_LightRadius;\n"
"varying vec3      var_Position;\n"
"varying vec3      var_Normal;\n"
"\n"
"void main()\n"
"{\n"
"\tvec3 lightToPos = var_Position - u_LightOrigin.xyz;\n"
"\tvec2 st = vec2(-dot(u_LightRight, lightToPos), dot(u_LightUp, lightToPos));\n"
"\t\n"
"\tfloat fade = length(st);\n"
"\t\n"
"#if defined(USE_DISCARD)\n"
"\tif (fade >= 1.0)\n"
"\t{\n"
"\t\tdiscard;\n"
"\t}\n"
"#endif\n"
"\n"
"\tfade = clamp(8.0 - fade * 8.0, 0.0, 1.0);\n"
"\t\n"
"\tst = st * 0.5 + vec2(0.5);\n"
"\n"
"#if defined(USE_SOLID_PSHADOWS)\n"
"\tfloat intensity = max(sign(u_LightRadius - length(lightToPos)), 0.0);\n"
"#else\n"
"\tfloat intensity = clamp((1.0 - dot(lightToPos, lightToPos) / (u_LightRadius * u_LightRadius)) * 2.0, 0.0, 1.0);\n"
"#endif\n"
"\t\n"
"\tfloat lightDist = length(lightToPos);\n"
"\tfloat dist;\n"
"\n"
"#if defined(USE_DISCARD)\n"
"\tif (dot(u_LightForward, lightToPos) <= 0.0)\n"
"\t{\n"
"\t\tdiscard;\n"
"\t}\n"
"\n"
"\tif (dot(var_Normal, lightToPos) > 0.0)\n"
"\t{\n"
"\t\tdiscard;\n"
"\t}\n"
"#else\n"
"\tintensity *= max(sign(dot(u_LightForward, lightToPos)), 0.0);\n"
"\tintensity *= max(sign(-dot(var_Normal, lightToPos)), 0.0);\n"
"#endif\n"
"\n"
"\tintensity *= fade;\n"
"\n"
"\tfloat part;\n"
"#if defined(USE_PCF)\n"
"\tpart  = float(texture2D(u_ShadowMap, st + vec2(-1.0/512.0, -1.0/512.0)).r != 1.0);\n"
"\tpart += float(texture2D(u_ShadowMap, st + vec2( 1.0/512.0, -1.0/512.0)).r != 1.0);\n"
"\tpart += float(texture2D(u_ShadowMap, st + vec2(-1.0/512.0,  1.0/512.0)).r != 1.0);\n"
"\tpart += float(texture2D(u_ShadowMap, st + vec2( 1.0/512.0,  1.0/512.0)).r != 1.0);\n"
"#else\n"
"\tpart  = float(texture2D(u_ShadowMap, st).r != 1.0);\n"
"#endif\n"
"\n"
"\tif (part <= 0.0)\n"
"\t{\n"
"\t\tdiscard;\n"
"\t}\n"
"\n"
"#if defined(USE_PCF)\n"
"\tintensity *= part * 0.25;\n"
"#else\n"
"\tintensity *= part;\n"
"#endif\n"
"\n"
"\tgl_FragColor.rgb = vec3(0);\n"
"\tgl_FragColor.a = clamp(intensity, 0.0, 0.75);\n"
"}\n"
;

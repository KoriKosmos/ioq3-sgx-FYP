const char *fallbackShader_dlight_vp =
"attribute vec3 attr_Position;\n"
"attribute vec4 attr_TexCoord0;\n"
"attribute vec3 attr_Normal;\n"
"\n"
"uniform vec4   u_DlightInfo;\n"
"\n"
"#if defined(USE_DEFORM_VERTEXES)\n"
"uniform int    u_DeformGen;\n"
"uniform float  u_DeformParams[5];\n"
"uniform float  u_Time;\n"
"#endif\n"
"\n"
"uniform vec4   u_Color;\n"
"uniform mat4   u_ModelViewProjectionMatrix;\n"
"\n"
"varying vec2   var_Tex1;\n"
"varying vec4   var_Color;\n"
"\n"
"#if defined(USE_DEFORM_VERTEXES)\n"
"vec3 DeformPosition(const vec3 pos, const vec3 normal, const vec2 st)\n"
"{\n"
"\tif (u_DeformGen == 0)\n"
"\t{\n"
"\t\treturn pos;\n"
"\t}\n"
"\n"
"\tfloat base =      u_DeformParams[0];\n"
"\tfloat amplitude = u_DeformParams[1];\n"
"\tfloat phase =     u_DeformParams[2];\n"
"\tfloat frequency = u_DeformParams[3];\n"
"\tfloat spread =    u_DeformParams[4];\n"
"\n"
"\tif (u_DeformGen == DGEN_BULGE)\n"
"\t{\n"
"\t\tphase *= st.x;\n"
"\t}\n"
"\telse // if (u_DeformGen <= DGEN_WAVE_INVERSE_SAWTOOTH)\n"
"\t{\n"
"\t\tphase += dot(pos.xyz, vec3(spread));\n"
"\t}\n"
"\n"
"\tfloat value = phase + (u_Time * frequency);\n"
"\tfloat func;\n"
"\n"
"\tif (u_DeformGen == DGEN_WAVE_SIN)\n"
"\t{\n"
"\t\tfunc = sin(value * 2.0 * M_PI);\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_SQUARE)\n"
"\t{\n"
"\t\tfunc = sign(0.5 - fract(value));\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_TRIANGLE)\n"
"\t{\n"
"\t\tfunc = abs(fract(value + 0.75) - 0.5) * 4.0 - 1.0;\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_SAWTOOTH)\n"
"\t{\n"
"\t\tfunc = fract(value);\n"
"\t}\n"
"\telse if (u_DeformGen == DGEN_WAVE_INVERSE_SAWTOOTH)\n"
"\t{\n"
"\t\tfunc = (1.0 - fract(value));\n"
"\t}\n"
"\telse // if (u_DeformGen == DGEN_BULGE)\n"
"\t{\n"
"\t\tfunc = sin(value);\n"
"\t}\n"
"\n"
"\treturn pos + normal * (base + func * amplitude);\n"
"}\n"
"#endif\n"
"\n"
"void main()\n"
"{\n"
"\tvec3 position = attr_Position;\n"
"\tvec3 normal = attr_Normal;\n"
"\n"
"#if defined(USE_DEFORM_VERTEXES)\n"
"\tposition = DeformPosition(position, normal, attr_TexCoord0.st);\n"
"#endif\n"
"\n"
"\tgl_Position = u_ModelViewProjectionMatrix * vec4(position, 1.0);\n"
"\t\t\n"
"\tvec3 dist = u_DlightInfo.xyz - position;\n"
"\n"
"\tvar_Tex1 = dist.xy * u_DlightInfo.a + vec2(0.5);\n"
"\tfloat dlightmod = step(0.0, dot(dist, normal));\n"
"\tdlightmod *= clamp(2.0 * (1.0 - abs(dist.z) * u_DlightInfo.a), 0.0, 1.0);\n"
"\t\n"
"\tvar_Color = u_Color * dlightmod;\n"
"}\n"
;

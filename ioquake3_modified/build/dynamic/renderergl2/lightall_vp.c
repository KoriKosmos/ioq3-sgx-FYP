const char *fallbackShader_lightall_vp =
"attribute vec4 attr_TexCoord0;\n"
"#if defined(USE_LIGHTMAP) || defined(USE_TCGEN)\n"
"attribute vec4 attr_TexCoord1;\n"
"#endif\n"
"attribute vec4 attr_Color;\n"
"\n"
"attribute vec3 attr_Position;\n"
"attribute vec3 attr_Normal;\n"
"attribute vec4 attr_Tangent;\n"
"\n"
"#if defined(USE_VERTEX_ANIMATION)\n"
"attribute vec3 attr_Position2;\n"
"attribute vec3 attr_Normal2;\n"
"attribute vec4 attr_Tangent2;\n"
"#elif defined(USE_BONE_ANIMATION)\n"
"attribute vec4 attr_BoneIndexes;\n"
"attribute vec4 attr_BoneWeights;\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_LIGHT_VECTOR)\n"
"attribute vec3 attr_LightDirection;\n"
"#endif\n"
"\n"
"#if defined(USE_DELUXEMAP)\n"
"uniform vec4   u_EnableTextures; // x = normal, y = deluxe, z = specular, w = cube\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"uniform vec3   u_ViewOrigin;\n"
"#endif\n"
"\n"
"#if defined(USE_TCGEN)\n"
"uniform int    u_TCGen0;\n"
"uniform vec3   u_TCGen0Vector0;\n"
"uniform vec3   u_TCGen0Vector1;\n"
"uniform vec3   u_LocalViewOrigin;\n"
"#endif\n"
"\n"
"#if defined(USE_TCMOD)\n"
"uniform vec4   u_DiffuseTexMatrix0;\n"
"uniform vec4   u_DiffuseTexMatrix1;\n"
"uniform vec4   u_DiffuseTexMatrix2;\n"
"uniform vec4   u_DiffuseTexMatrix3;\n"
"uniform vec4   u_DiffuseTexMatrix4;\n"
"uniform vec4   u_DiffuseTexMatrix5;\n"
"uniform vec4   u_DiffuseTexMatrix6;\n"
"uniform vec4   u_DiffuseTexMatrix7;\n"
"#endif\n"
"\n"
"uniform mat4   u_ModelViewProjectionMatrix;\n"
"uniform vec4   u_BaseColor;\n"
"uniform vec4   u_VertColor;\n"
"\n"
"#if defined(USE_MODELMATRIX)\n"
"uniform mat4   u_ModelMatrix;\n"
"#endif\n"
"\n"
"#if defined(USE_VERTEX_ANIMATION)\n"
"uniform float  u_VertexLerp;\n"
"#elif defined(USE_BONE_ANIMATION)\n"
"uniform mat4 u_BoneMatrix[MAX_GLSL_BONES];\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT_VECTOR)\n"
"uniform vec4   u_LightOrigin;\n"
"uniform float  u_LightRadius;\n"
"uniform vec3   u_DirectedLight;\n"
"uniform vec3   u_AmbientLight;\n"
"#endif\n"
"\n"
"#if defined(USE_PRIMARY_LIGHT) || defined(USE_SHADOWMAP)\n"
"uniform vec4  u_PrimaryLightOrigin;\n"
"uniform float u_PrimaryLightRadius;\n"
"#endif\n"
"\n"
"varying vec4   var_TexCoords;\n"
"\n"
"varying vec4   var_Color;\n"
"#if defined(USE_LIGHT_VECTOR) && !defined(USE_FAST_LIGHT)\n"
"varying vec4   var_ColorAmbient;\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"varying vec4   var_Normal;\n"
"varying vec4   var_Tangent;\n"
"varying vec4   var_Bitangent;\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"varying vec4   var_LightDir;\n"
"#endif\n"
"\n"
"#if defined(USE_PRIMARY_LIGHT) || defined(USE_SHADOWMAP)\n"
"varying vec4   var_PrimaryLightDir;\n"
"#endif\n"
"\n"
"#if defined(USE_TCGEN)\n"
"vec2 GenTexCoords(int TCGen, vec3 position, vec3 normal, vec3 TCGenVector0, vec3 TCGenVector1)\n"
"{\n"
"\tvec2 tex = attr_TexCoord0.st;\n"
"\n"
"\tif (TCGen == TCGEN_LIGHTMAP)\n"
"\t{\n"
"\t\ttex = attr_TexCoord1.st;\n"
"\t}\n"
"\telse if (TCGen == TCGEN_ENVIRONMENT_MAPPED)\n"
"\t{\n"
"\t\tvec3 viewer = normalize(u_LocalViewOrigin - position);\n"
"\t\tvec2 ref = reflect(viewer, normal).yz;\n"
"\t\ttex.s = ref.x * -0.5 + 0.5;\n"
"\t\ttex.t = ref.y *  0.5 + 0.5;\n"
"\t}\n"
"\telse if (TCGen == TCGEN_VECTOR)\n"
"\t{\n"
"\t\ttex = vec2(dot(position, TCGenVector0), dot(position, TCGenVector1));\n"
"\t}\n"
"\n"
"\treturn tex;\n"
"}\n"
"#endif\n"
"\n"
"#if defined(USE_TCMOD)\n"
"vec2 ModTexCoords(vec2 st, vec3 position, vec4 texMatrix[8])\n"
"{\n"
"\tvec2 st2 = st;\n"
"\tvec2 offsetPos = vec2(position.x + position.z, position.y);\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[0].x + st2.y * texMatrix[0].y + texMatrix[0].z,\n"
"\t           st2.x * texMatrix[1].x + st2.y * texMatrix[1].y + texMatrix[1].z);\n"
"\tst2 += texMatrix[0].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[1].w * 2.0 * M_PI));\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[2].x + st2.y * texMatrix[2].y + texMatrix[2].z,\n"
"\t           st2.x * texMatrix[3].x + st2.y * texMatrix[3].y + texMatrix[3].z);\n"
"\tst2 += texMatrix[2].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[3].w * 2.0 * M_PI));\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[4].x + st2.y * texMatrix[4].y + texMatrix[4].z,\n"
"\t           st2.x * texMatrix[5].x + st2.y * texMatrix[5].y + texMatrix[5].z);\n"
"\tst2 += texMatrix[4].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[5].w * 2.0 * M_PI));\n"
"\n"
"\tst2 = vec2(st2.x * texMatrix[6].x + st2.y * texMatrix[6].y + texMatrix[6].z,\n"
"\t           st2.x * texMatrix[7].x + st2.y * texMatrix[7].y + texMatrix[7].z);\n"
"\tst2 += texMatrix[6].w * sin(offsetPos * (2.0 * M_PI / 1024.0) + vec2(texMatrix[7].w * 2.0 * M_PI));\n"
"\n"
"\treturn st2;\n"
"}\n"
"#endif\n"
"\n"
"\n"
"float CalcLightAttenuation(float point, float normDist)\n"
"{\n"
"\t// zero light at 1.0, approximating q3 style\n"
"\t// also don't attenuate directional light\n"
"\tfloat attenuation = (0.5 * normDist - 1.5) * point + 1.0;\n"
"\n"
"\t// clamp attenuation\n"
"\t#if defined(NO_LIGHT_CLAMP)\n"
"\tattenuation = max(attenuation, 0.0);\n"
"\t#else\n"
"\tattenuation = clamp(attenuation, 0.0, 1.0);\n"
"\t#endif\n"
"\n"
"\treturn attenuation;\n"
"}\n"
"\n"
"\n"
"void main()\n"
"{\n"
"#if defined(USE_VERTEX_ANIMATION)\n"
"\tvec3 position  = mix(attr_Position,    attr_Position2,    u_VertexLerp);\n"
"\tvec3 normal    = mix(attr_Normal,      attr_Normal2,      u_VertexLerp);\n"
"  #if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\tvec3 tangent   = mix(attr_Tangent.xyz, attr_Tangent2.xyz, u_VertexLerp);\n"
"  #endif\n"
"#elif defined(USE_BONE_ANIMATION)\n"
"\tmat4 vtxMat  = u_BoneMatrix[int(attr_BoneIndexes.x)] * attr_BoneWeights.x;\n"
"\t     vtxMat += u_BoneMatrix[int(attr_BoneIndexes.y)] * attr_BoneWeights.y;\n"
"\t     vtxMat += u_BoneMatrix[int(attr_BoneIndexes.z)] * attr_BoneWeights.z;\n"
"\t     vtxMat += u_BoneMatrix[int(attr_BoneIndexes.w)] * attr_BoneWeights.w;\n"
"\tmat3 nrmMat = mat3(cross(vtxMat[1].xyz, vtxMat[2].xyz), cross(vtxMat[2].xyz, vtxMat[0].xyz), cross(vtxMat[0].xyz, vtxMat[1].xyz));\n"
"\n"
"\tvec3 position  = vec3(vtxMat * vec4(attr_Position, 1.0));\n"
"\tvec3 normal    = normalize(nrmMat * attr_Normal);\n"
"  #if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\tvec3 tangent   = normalize(nrmMat * attr_Tangent.xyz);\n"
"  #endif\n"
"#else\n"
"\tvec3 position  = attr_Position;\n"
"\tvec3 normal    = attr_Normal;\n"
"  #if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\tvec3 tangent   = attr_Tangent.xyz;\n"
"  #endif\n"
"#endif\n"
"\n"
"#if defined(USE_TCGEN)\n"
"\tvec2 texCoords = GenTexCoords(u_TCGen0, position, normal, u_TCGen0Vector0, u_TCGen0Vector1);\n"
"#else\n"
"\tvec2 texCoords = attr_TexCoord0.st;\n"
"#endif\n"
"\n"
"#if defined(USE_TCMOD)\n"
"\tvec4 diffuseTexMatrix[8];\n"
"\tdiffuseTexMatrix[0] = u_DiffuseTexMatrix0;\n"
"\tdiffuseTexMatrix[1] = u_DiffuseTexMatrix1;\n"
"\tdiffuseTexMatrix[2] = u_DiffuseTexMatrix2;\n"
"\tdiffuseTexMatrix[3] = u_DiffuseTexMatrix3;\n"
"\tdiffuseTexMatrix[4] = u_DiffuseTexMatrix4;\n"
"\tdiffuseTexMatrix[5] = u_DiffuseTexMatrix5;\n"
"\tdiffuseTexMatrix[6] = u_DiffuseTexMatrix6;\n"
"\tdiffuseTexMatrix[7] = u_DiffuseTexMatrix7;\n"
"\tvar_TexCoords.xy = ModTexCoords(texCoords, position, diffuseTexMatrix);\n"
"#else\n"
"\tvar_TexCoords.xy = texCoords;\n"
"#endif\n"
"\n"
"\tgl_Position = u_ModelViewProjectionMatrix * vec4(position, 1.0);\n"
"\n"
"#if defined(USE_MODELMATRIX)\n"
"\tposition  = (u_ModelMatrix * vec4(position, 1.0)).xyz;\n"
"\tnormal    = (u_ModelMatrix * vec4(normal,   0.0)).xyz;\n"
"  #if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\ttangent   = (u_ModelMatrix * vec4(tangent,  0.0)).xyz;\n"
"  #endif\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\tvec3 bitangent = cross(normal, tangent) * attr_Tangent.w;\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT_VECTOR)\n"
"\tvec3 L = u_LightOrigin.xyz - (position * u_LightOrigin.w);\n"
"#elif defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\tvec3 L = attr_LightDirection;\n"
"  #if defined(USE_MODELMATRIX)\n"
"\tL = (u_ModelMatrix * vec4(L, 0.0)).xyz;\n"
"  #endif\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHTMAP)\n"
"\tvar_TexCoords.zw = attr_TexCoord1.st;\n"
"#endif\n"
"\n"
"\tvar_Color = u_VertColor * attr_Color + u_BaseColor;\n"
"\n"
"#if defined(USE_LIGHT_VECTOR)\n"
"  #if defined(USE_FAST_LIGHT)\n"
"\tfloat sqrLightDist = dot(L, L);\n"
"\tfloat NL = clamp(dot(normalize(normal), L) / sqrt(sqrLightDist), 0.0, 1.0);\n"
"\tfloat attenuation = CalcLightAttenuation(u_LightOrigin.w, u_LightRadius * u_LightRadius / sqrLightDist);\n"
"\n"
"\tvar_Color.rgb *= u_DirectedLight * (attenuation * NL) + u_AmbientLight;\n"
"  #else\n"
"\tvar_ColorAmbient.rgb = u_AmbientLight * var_Color.rgb;\n"
"\tvar_Color.rgb *= u_DirectedLight;\n"
"    #if defined(USE_PBR)\n"
"\tvar_ColorAmbient.rgb *= var_ColorAmbient.rgb;\n"
"    #endif\n"
"  #endif\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT) && defined(USE_PBR)\n"
"\tvar_Color.rgb *= var_Color.rgb;\n"
"#endif\n"
"\n"
"#if defined(USE_PRIMARY_LIGHT) || defined(USE_SHADOWMAP)\n"
"\tvar_PrimaryLightDir.xyz = u_PrimaryLightOrigin.xyz - (position * u_PrimaryLightOrigin.w);\n"
"\tvar_PrimaryLightDir.w = u_PrimaryLightRadius * u_PrimaryLightRadius;\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"  #if defined(USE_LIGHT_VECTOR)\n"
"\tvar_LightDir = vec4(L, u_LightRadius * u_LightRadius);\n"
"  #else\n"
"\tvar_LightDir = vec4(L, 0.0);\n"
"  #endif\n"
"  #if defined(USE_DELUXEMAP)\n"
"\tvar_LightDir -= u_EnableTextures.y * var_LightDir;\n"
"  #endif\n"
"#endif\n"
"\n"
"#if defined(USE_LIGHT) && !defined(USE_FAST_LIGHT)\n"
"\tvec3 viewDir = u_ViewOrigin - position;\n"
"\t// store view direction in tangent space to save on varyings\n"
"\tvar_Normal    = vec4(normal,    viewDir.x);\n"
"\tvar_Tangent   = vec4(tangent,   viewDir.y);\n"
"\tvar_Bitangent = vec4(bitangent, viewDir.z);\n"
"#endif\n"
"}\n"
;
